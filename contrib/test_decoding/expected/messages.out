-- predictability
SET synchronous_commit = on;
SELECT 'init' FROM pg_create_logical_replication_slot('regression_slot', 'test_decoding');
 ?column? 
----------
 init
(1 row)

SELECT 'msg1' FROM pg_logical_send_message(true, 'test', 'msg1');
 ?column? 
----------
 msg1
(1 row)

SELECT 'msg2' FROM pg_logical_send_message(false, 'test', 'msg2');
 ?column? 
----------
 msg2
(1 row)

BEGIN;
SELECT 'msg3' FROM pg_logical_send_message(true, 'test', 'msg3');
 ?column? 
----------
 msg3
(1 row)

SELECT 'msg4' FROM pg_logical_send_message(false, 'test', 'msg4');
 ?column? 
----------
 msg4
(1 row)

SELECT 'msg5' FROM pg_logical_send_message(true, 'test', 'msg5');
 ?column? 
----------
 msg5
(1 row)

COMMIT;
SELECT regexp_replace(data, 'lsn: [^ ]+', '') FROM pg_logical_slot_get_changes('regression_slot', NULL, NULL, 'force-binary', '0', 'skip-empty-xacts', '1');
                       regexp_replace                        
-------------------------------------------------------------
 message:  transactional: 1 prefix: test, sz: 4 content:msg1
 message:  transactional: 0 prefix: test, sz: 4 content:msg2
 message:  transactional: 0 prefix: test, sz: 4 content:msg4
 message:  transactional: 1 prefix: test, sz: 4 content:msg3
 message:  transactional: 1 prefix: test, sz: 4 content:msg5
(5 rows)

SELECT 'init' FROM pg_drop_replication_slot('regression_slot');
 ?column? 
----------
 init
(1 row)

